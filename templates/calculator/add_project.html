<!-- templates/calculator/add_project.html -->
{% extends "calculator/base.html" %}

{% block title %}مدل جدید - {{ filament.name }}{% endblock %}

{% block content %}
<div class="container-fluid px-2 px-md-4">
  <!-- Modern Hero Section -->
  <div class="modern-hero-card mb-4">
    <div class="hero-background"></div>
    <div class="hero-content">
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
        <div>
          <div class="d-flex align-items-center gap-2">
            <span class="hero-icon-modern"><i class="fas fa-cube"></i></span>
            <h1 class="hero-title-modern mb-0">افزودن مدل جدید</h1>
          </div>
          <div class="hero-subtitle-modern mt-2">
            مشخصات مدل را وارد کنید، تصویر را اضافه کنید و هزینه‌ها را به‌صورت زنده مشاهده کنید
          </div>
        </div>
        <div class="d-flex flex-wrap align-items-center gap-2">
          <span class="badge-modern badge-primary">
            <i class="fas fa-flask ms-1"></i>{{ filament.material }}
          </span>
          <span class="badge-modern badge-success">
            <i class="fas fa-spool ms-1"></i>{{ filament.name }} - {{ filament.color }}
          </span>
          <span class="badge-modern badge-warning">
            <i class="fas fa-ruler ms-1"></i>باقی‌مانده: {{ filament.remaining_amount|floatformat:1 }} m
          </span>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Main form -->
    <div class="col-12 col-xl-8">
      <form method="post" enctype="multipart/form-data" id="model-form">
        {% csrf_token %}

        <!-- Section: Basic -->
        <div class="card modern-card">
          <div class="card-header border-0 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2">
              <span class="step-badge">1</span>
              <h5 class="mb-0">اطلاعات پایه</h5>
            </div>
            <span class="text-light small opacity-75">نام مدل و تصویر</span>
          </div>
          <div class="card-body">
            <div class="row g-3 align-items-start">
              <div class="col-md-8">
                <label for="id_model_name" class="form-label">نام مدل</label>
                <div class="input-group modern-input">
                  <span class="input-group-text"><i class="fas fa-cube"></i></span>
                  {{ form.model_name }}
                </div>
                {% if form.model_name.errors %}
                  <div class="text-danger small mt-1">{{ form.model_name.errors.0 }}</div>
                {% else %}
                  <div class="form-text">مثال: گلدان دکوراتیو، فیگور قهرمان، هاب کابل</div>
                {% endif %}
              </div>
              <div class="col-md-4">
                <label for="id_picture" class="form-label">تصویر مدل</label>
                <div class="upload-modern" id="upload-tile">
                  <div class="upload-icon-modern"><i class="fas fa-cloud-upload-alt"></i></div>
                  <div class="upload-hint-modern">برای انتخاب تصویر کلیک کنید</div>
                  {{ form.picture }}
                  <img id="previewImg" alt="پیش‌نمایش مدل" class="preview-image-modern" />
                </div>
                {% if form.picture.errors %}
                  <div class="text-danger small mt-1">{{ form.picture.errors.0 }}</div>
                {% else %}
                  <div class="form-text">فرمت‌های مجاز: JPG, PNG | حداکثر 5MB</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Technical -->
        <div class="card modern-card mt-4">
          <div class="card-header border-0 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2">
              <span class="step-badge">2</span>
              <h5 class="mb-0">مشخصات فنی</h5>
            </div>
            <span class="text-light small opacity-75">فیلامنت، زمان و ابعاد</span>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="id_filament_used_mm" class="form-label">فیلامنت مصرفی</label>
                <div class="input-group modern-input">
                  <span class="input-group-text"><i class="fas fa-ruler"></i></span>
                  {{ form.filament_used_mm }}
                  <span class="input-group-text">mm</span>
                </div>
                {% if form.filament_used_mm.errors %}
                  <div class="text-danger small mt-1">{{ form.filament_used_mm.errors.0 }}</div>
                {% else %}
                  <div class="form-text">هر 1000mm = 1m. مثال: 15000</div>
                {% endif %}
              </div>
              <div class="col-md-6">
                <label for="id_print_time_hours" class="form-label">زمان پرینت</label>
                <div class="input-group modern-input">
                  <span class="input-group-text"><i class="fas fa-clock"></i></span>
                  {{ form.print_time_hours }}
                  <span class="input-group-text">h</span>
                </div>
                {% if form.print_time_hours.errors %}
                  <div class="text-danger small mt-1">{{ form.print_time_hours.errors.0 }}</div>
                {% else %}
                  <div class="form-text">مثال: 3.5</div>
                {% endif %}
              </div>
            </div>

            <div class="row g-3 mt-1">
              <div class="col-md-4">
                <label for="id_size_x" class="form-label">طول (X)</label>
                <div class="input-group modern-input">
                  <span class="input-group-text">X</span>
                  {{ form.size_x }}
                  <span class="input-group-text">mm</span>
                </div>
                {% if form.size_x.errors %}
                  <div class="text-danger small mt-1">{{ form.size_x.errors.0 }}</div>
                {% endif %}
              </div>
              <div class="col-md-4">
                <label for="id_size_y" class="form-label">عرض (Y)</label>
                <div class="input-group modern-input">
                  <span class="input-group-text">Y</span>
                  {{ form.size_y }}
                  <span class="input-group-text">mm</span>
                </div>
                {% if form.size_y.errors %}
                  <div class="text-danger small mt-1">{{ form.size_y.errors.0 }}</div>
                {% endif %}
              </div>
              <div class="col-md-4">
                <label for="id_size_z" class="form-label">ارتفاع (Z)</label>
                <div class="input-group modern-input">
                  <span class="input-group-text">Z</span>
                  {{ form.size_z }}
                  <span class="input-group-text">mm</span>
                </div>
                {% if form.size_z.errors %}
                  <div class="text-danger small mt-1">{{ form.size_z.errors.0 }}</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Services -->
        <div class="card modern-card mt-4">
          <div class="card-header border-0 d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2">
              <span class="step-badge">3</span>
              <h5 class="mb-0">خدمات اضافی</h5>
            </div>
            <span class="text-light small opacity-75">اختیاری</span>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="service-modern">
                  <div class="form-check m-0">
                    {{ form.post_processing_enabled }}
                    <label class="form-check-label" for="post_processing_enabled">
                      <i class="fas fa-hammer me-2"></i>پست‌پروسسینگ
                      <small class="text-muted d-block">پرداخت، سنباده، حذف ساپورت</small>
                    </label>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="service-modern">
                  <div class="form-check m-0">
                    {{ form.painting_enabled }}
                    <label class="form-check-label" for="painting_enabled">
                      <i class="fas fa-palette me-2"></i>رنگ‌آمیزی
                      <small class="text-muted d-block">محاسبه بر اساس حجم</small>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            <div class="alert alert-info mt-3 mb-0" style="background: var(--info-50); border: 1px solid var(--info-200); color: var(--info-800);">
              <i class="fas fa-info-circle me-2"></i>
              می‌توانید هر زمان این گزینه‌ها را تغییر دهید. هزینه‌ها به‌صورت زنده بروزرسانی می‌شوند.
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="d-flex flex-wrap gap-3 mt-4">
          <button type="submit" class="btn btn-success btn-lg flex-fill">
            <i class="fas fa-save me-2"></i>ذخیره مدل
          </button>
          <a href="{% url 'calculator:view_filament' filament.pk %}" class="btn btn-outline-secondary btn-lg">
            <i class="fas fa-arrow-left me-2"></i>بازگشت
          </a>
        </div>
      </form>
    </div>

    <!-- Cost preview sidebar -->
    <div class="col-12 col-xl-4">
      <div class="sticky-top" style="top: 90px;">
        <div class="card cost-card-modern">
          <div class="card-header d-flex align-items-center justify-content-between" style="background: linear-gradient(135deg, var(--secondary-700), var(--secondary-800)); color: white;">
            <div class="d-flex align-items-center gap-2">
              <i class="fas fa-calculator text-white"></i>
              <h6 class="mb-0">پیش‌نمایش محاسبات</h6>
            </div>
            <small id="preview-status" class="text-light opacity-75">آماده محاسبه</small>
          </div>
          <div class="card-body" style="background: white;">
            <div id="calc-empty" class="empty-state-modern">
              <div class="empty-icon-modern"><i class="fas fa-info-circle"></i></div>
              <div class="empty-text-modern">برای مشاهده محاسبات، مقادیر فنی را وارد کنید</div>
            </div>

            <div id="cost-preview" class="d-none">
              <div class="calculation-grid">
                <div class="calc-item">
                  <div class="calc-icon">
                    <i class="fas fa-weight"></i>
                  </div>
                  <div class="calc-details">
                    <span class="calc-label">وزن فیلامنت</span>
                    <strong id="filament-weight" class="calc-value">0 گرم</strong>
                  </div>
                </div>
                
                <div class="calc-item">
                  <div class="calc-icon bg-success">
                    <i class="fas fa-spool"></i>
                  </div>
                  <div class="calc-details">
                    <span class="calc-label">هزینه مواد</span>
                    <strong id="material-cost" class="calc-value text-success">0 تومان</strong>
                  </div>
                </div>
                
                <div class="calc-item">
                  <div class="calc-icon bg-warning">
                    <i class="fas fa-bolt"></i>
                  </div>
                  <div class="calc-details">
                    <span class="calc-label">هزینه برق</span>
                    <strong id="electricity-cost" class="calc-value text-warning">0 تومان</strong>
                  </div>
                </div>
                
                <div class="calc-item">
                  <div class="calc-icon bg-secondary">
                    <i class="fas fa-tools"></i>
                  </div>
                  <div class="calc-details">
                    <span class="calc-label">استهلاک دستگاه</span>
                    <strong id="depreciation-cost" class="calc-value text-secondary">0 تومان</strong>
                  </div>
                </div>

                <div class="calc-item d-none" id="post-processing-row">
                  <div class="calc-icon bg-info">
                    <i class="fas fa-hammer"></i>
                  </div>
                  <div class="calc-details">
                    <span class="calc-label">پست‌پروسسینگ</span>
                    <strong id="post-processing-cost" class="calc-value text-info">0 تومان</strong>
                  </div>
                </div>
                
                <div class="calc-item d-none" id="painting-row">
                  <div class="calc-icon bg-danger">
                    <i class="fas fa-palette"></i>
                  </div>
                  <div class="calc-details">
                    <span class="calc-label">رنگ‌آمیزی</span>
                    <strong id="painting-cost" class="calc-value text-danger">0 تومان</strong>
                  </div>
                </div>
              </div>

              <!-- Total Cost Section -->
              <div class="total-section">
                <div class="d-flex justify-content-between align-items-center p-3 border rounded" style="background: var(--secondary-50); border-color: var(--secondary-200) !important;">
                  <span class="fw-bold" style="color: var(--secondary-700);">
                    <i class="fas fa-calculator me-2"></i>کل هزینه
                  </span>
                  <strong id="total-cost" class="fs-5" style="color: var(--danger-600);">0 تومان</strong>
                </div>
              </div>

              <!-- Selling Price Highlight -->
              <div class="pricing-highlight-modern mt-3">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <div class="label-modern">قیمت پیشنهادی فروش</div>
                    <small id="profit-margin" class="profit-text">سود: 0 تومان</small>
                  </div>
                  <div class="price-modern" id="selling-price">0 تومان</div>
                </div>
              </div>

              <div class="text-center mt-3">
                <small style="color: var(--secondary-500);">محاسبات بر اساس تنظیمات پیش‌فرض انجام می‌شود</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Filament summary -->
        <div class="card mt-3" style="background: rgba(255,255,255,0.9); border: 1px solid var(--primary-200);">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <div class="fw-bold" style="color: var(--secondary-800);">{{ filament.name }}</div>
              <small style="color: var(--secondary-600);">{{ filament.material }} | {{ filament.color }}</small>
            </div>
            <span class="badge" style="background: var(--warning-500); color: white; padding: 0.5rem 0.75rem; border-radius: 8px;">
              {{ filament.remaining_amount|floatformat:1 }} m
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Elements
  const filamentUsed = document.getElementById('id_filament_used_mm');
  const printTime = document.getElementById('id_print_time_hours');
  const sizeX = document.getElementById('id_size_x');
  const sizeY = document.getElementById('id_size_y');
  const sizeZ = document.getElementById('id_size_z');
  const postProcessing = document.getElementById('post_processing_enabled') || document.getElementById('id_post_processing_enabled');
  const painting = document.getElementById('painting_enabled') || document.getElementById('id_painting_enabled');

  const previewStatus = document.getElementById('preview-status');
  const costPreview = document.getElementById('cost-preview');
  const emptyState = document.getElementById('calc-empty');

  const filamentCostPerKg = {{ filament.cost_per_kg|default:25000 }};

  // Upload tile preview
  (function initUploadTile() {
    const input = document.getElementById('id_picture');
    const tile = document.getElementById('upload-tile');
    const img = document.getElementById('previewImg');
    if (!input || !tile || !img) return;
    // Make whole tile clickable
    tile.addEventListener('click', () => input.click());
    input.addEventListener('change', e => {
      const file = e.target.files && e.target.files[0];
      if (!file) {
        img.src = '';
        img.classList.remove('show');
        tile.classList.remove('has-image');
        return;
      }
      const reader = new FileReader();
      reader.onload = ev => {
        img.src = ev.target.result;
        img.classList.add('show');
        tile.classList.add('has-image');
      };
      reader.readAsDataURL(file);
    });
  })();

  function fmt(n) {
    return new Intl.NumberFormat('fa-IR').format(Math.round(n || 0));
  }

  function hasInputs() {
    return (
      parseFloat(filamentUsed?.value || 0) > 0 &&
      parseFloat(printTime?.value || 0) > 0 &&
      parseFloat(sizeX?.value || 0) > 0 &&
      parseFloat(sizeY?.value || 0) > 0 &&
      parseFloat(sizeZ?.value || 0) > 0
    );
  }

  let isCalculating = false;

  function updateCalculationPreview() {
    if (!hasInputs()) {
      costPreview.classList.add('d-none');
      emptyState.classList.remove('d-none');
      if (previewStatus) { previewStatus.textContent = 'آماده محاسبه'; previewStatus.className = 'text-light opacity-75'; }
      return;
    }
    if (isCalculating) return;
    isCalculating = true;

    if (previewStatus) { previewStatus.textContent = 'در حال محاسبه...'; previewStatus.className = 'text-warning pulse'; }

    const data = {
      filament_used_mm: parseFloat(filamentUsed.value),
      print_time_hours: parseFloat(printTime.value),
      size_x: parseFloat(sizeX.value),
      size_y: parseFloat(sizeY.value),
      size_z: parseFloat(sizeZ.value),
      filament_cost_per_kg: filamentCostPerKg,
      post_processing_enabled: !!(postProcessing && postProcessing.checked),
      painting_enabled: !!(painting && painting.checked),
      packaging_cost: 0
    };

    fetch('{% url "calculator:calculate_preview" %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      },
      body: JSON.stringify(data)
    })
    .then(r => r.json())
    .then(d => {
      if (d.error) throw new Error(d.error);

      // Show section
      costPreview.classList.remove('d-none');
      emptyState.classList.add('d-none');

      setText('filament-weight', fmt(d.filament_weight) + ' گرم');
      setText('material-cost', fmt(d.material_cost) + ' تومان');
      setText('electricity-cost', fmt(d.electricity_cost) + ' تومان');
      setText('depreciation-cost', fmt(d.depreciation_cost) + ' تومان');
      setText('total-cost', fmt(d.total_cost) + ' تومان');
      setText('selling-price', fmt(d.selling_price) + ' تومان');

      toggleRow('post-processing-row', d.post_processing_cost > 0, 'post-processing-cost', d.post_processing_cost);
      toggleRow('painting-row', d.painting_cost > 0, 'painting-cost', d.painting_cost);

      const profit = (d.selling_price || 0) - (d.total_cost || 0);
      setText('profit-margin', 'سود: ' + fmt(profit) + ' تومان');

      if (previewStatus) { previewStatus.textContent = 'محاسبه شد ✅'; previewStatus.className = 'text-success'; }
    })
    .catch(err => {
      if (previewStatus) { previewStatus.textContent = 'خطا در محاسبه'; previewStatus.className = 'text-danger'; }
      console.error(err);
    })
    .finally(() => { isCalculating = false; });
  }

  function setText(id, val) {
    const el = document.getElementById(id);
    if (el) el.textContent = val;
  }

  function toggleRow(rowId, show, valueId, value) {
    const row = document.getElementById(rowId);
    if (!row) return;
    if (show) {
      row.classList.remove('d-none');
      const el = document.getElementById(valueId);
      if (el) el.textContent = fmt(value) + ' تومان';
      row.classList.add('glow-once');
      setTimeout(() => row.classList.remove('glow-once'), 600);
    } else {
      row.classList.add('d-none');
    }
  }

  // Debounce
  function debounce(fn, wait) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), wait); }; }
  const debounced = debounce(updateCalculationPreview, 300);

  [filamentUsed, printTime, sizeX, sizeY, sizeZ].forEach(el => {
    if (!el) return;
    el.addEventListener('input', debounced);
    el.addEventListener('blur', updateCalculationPreview);
  });

  if (postProcessing) postProcessing.addEventListener('change', () => setTimeout(updateCalculationPreview, 10));
  if (painting) painting.addEventListener('change', () => setTimeout(updateCalculationPreview, 10));

  // Initial calculation
  setTimeout(updateCalculationPreview, 500);

  // Prevent submit while calculating
  const form = document.getElementById('model-form');
  if (form) {
    form.addEventListener('submit', function(e) {
      if (isCalculating) {
        e.preventDefault();
        alert('لطفاً منتظر تکمیل محاسبات باشید');
      }
    });
  }
});
</script>

<style>
/* Modern Hero */
.modern-hero-card {
  position: relative;
  border-radius: var(--border-radius-xl);
  overflow: hidden;
  padding: var(--spacing-xl);
  background: rgba(255,255,255,0.7);
  backdrop-filter: blur(20px);
  border: 1px solid var(--primary-200);
  box-shadow: var(--shadow-lg);
}
.hero-background {
  position: absolute; inset: 0;
  background: radial-gradient(1200px 400px at 100% -10%, var(--success-100), transparent),
              radial-gradient(600px 300px at -10% 120%, var(--primary-100), transparent);
  pointer-events: none;
}
.hero-content { position: relative; z-index: 1; }
.hero-icon-modern {
  display: inline-flex; width: 40px; height: 40px;
  border-radius: var(--border-radius-md); align-items: center; justify-content: center;
  background: linear-gradient(135deg, var(--primary-500), var(--success-500)); 
  color: #fff;
  box-shadow: var(--shadow-md);
}
.hero-title-modern { font-size: 1.4rem; font-weight: 800; color: var(--secondary-800); }
.hero-subtitle-modern { color: var(--secondary-600); font-size: .95rem; }

/* Modern Badges */
.badge-modern {
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--border-radius-sm);
  font-weight: 600;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.025em;
}
.badge-primary { background: var(--primary-500); color: white; }
.badge-success { background: var(--success-500); color: white; }
.badge-warning { background: var(--warning-500); color: white; }

/* Modern Cards */
.modern-card {
  background: rgba(255, 255, 255, 0.8);
  backdrop-filter: blur(20px);
  border: 1px solid var(--primary-200);
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

.step-badge {
  width: 28px; height: 28px; display: inline-flex; align-items: center; justify-content: center;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--success-500), var(--primary-500)); 
  color: #fff; font-weight: 700;
  box-shadow: var(--shadow-md);
}

/* Modern Inputs */
.modern-input .input-group-text { 
  background: var(--surface-100); 
  border-color: var(--secondary-200);
}
.modern-input .form-control { 
  border-left: 0; 
}

/* Upload Tile */
.upload-modern {
  position: relative;
  border: 2px dashed var(--primary-300);
  border-radius: var(--border-radius-lg);
  padding: var(--spacing-lg);
  text-align: center;
  background: var(--primary-50);
  cursor: pointer;
  transition: all 0.3s ease;
}
.upload-modern:hover { 
  border-color: var(--primary-500); 
  background: var(--primary-100);
}
.upload-icon-modern { 
  font-size: 28px; 
  color: var(--primary-500); 
  margin-bottom: var(--spacing-sm); 
}
.upload-hint-modern { 
  color: var(--secondary-600); 
  font-size: .875rem; 
}
#id_picture {
  position: absolute; inset: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;
}
.preview-image-modern {
  display: block;
  width: 100%; height: 180px; object-fit: cover;
  border-radius: var(--border-radius-md); margin-top: var(--spacing-sm); 
  opacity: 0; transition: opacity .25s ease;
}
.preview-image-modern.show { opacity: 1; }
.upload-modern.has-image { background: var(--surface-100); }

/* Services */
.service-modern {
  border: 1px solid var(--secondary-200);
  border-radius: var(--border-radius-lg);
  padding: var(--spacing-lg);
  transition: all 0.3s ease;
  background: rgba(255, 255, 255, 0.8);
}
.service-modern:hover { 
  border-color: var(--primary-300); 
  box-shadow: var(--shadow-sm); 
}

/* Fixed Cost Card Styling */
.cost-card-modern {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border: 1px solid var(--secondary-200);
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

/* Calculation Grid */
.calculation-grid {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.calc-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem;
  background: var(--surface-50);
  border: 1px solid var(--secondary-200);
  border-radius: var(--border-radius-md);
  transition: all 0.3s ease;
}

.calc-item:hover {
  background: var(--primary-50);
  border-color: var(--primary-300);
  transform: translateX(2px);
}

.calc-icon {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--border-radius-sm);
  background: var(--primary-100);
  color: var(--primary-600);
  font-size: 0.9rem;
}

.calc-icon.bg-success {
  background: var(--success-100);
  color: var(--success-600);
}

.calc-icon.bg-warning {
  background: var(--warning-100);
  color: var(--warning-600);
}

.calc-icon.bg-secondary {
  background: var(--secondary-100);
  color: var(--secondary-600);
}

.calc-icon.bg-info {
  background: var(--info-100);
  color: var(--info-600);
}

.calc-icon.bg-danger {
  background: var(--danger-100);
  color: var(--danger-600);
}

.calc-details {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.calc-label {
  font-size: 0.85rem;
  color: var(--secondary-600);
  margin-bottom: 0.25rem;
}

.calc-value {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--secondary-800);
}

/* Total Section */
.total-section {
  margin: 1rem 0;
}

/* Pricing Highlight */
.pricing-highlight-modern {
  background: linear-gradient(135deg, var(--success-500), var(--success-600));
  border-radius: var(--border-radius-lg);
  color: white;
  padding: 1rem;
  box-shadow: var(--shadow-md);
  position: relative;
  overflow: hidden;
}

.pricing-highlight-modern::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, transparent, rgba(255,255,255,0.1));
  pointer-events: none;
}

.pricing-highlight-modern > * {
  position: relative;
  z-index: 1;
}

.label-modern {
  font-weight: 600;
  font-size: 0.9rem;
  opacity: 0.95;
}

.profit-text {
  opacity: 0.8;
  font-size: 0.8rem;
}

.price-modern {
  font-size: 1.25rem;
  font-weight: 800;
}

/* Empty State */
.empty-state-modern {
  text-align: center;
  padding: 2rem 1rem;
  color: var(--secondary-500);
}

.empty-icon-modern {
  font-size: 2.5rem;
  color: var(--secondary-400);
  margin-bottom: 0.75rem;
}

.empty-text-modern {
  font-size: 0.9rem;
  color: var(--secondary-600);
}

/* Glow Animation for New Items */
.glow-once {
  animation: glow 0.6s ease;
}

@keyframes glow {
  0% { 
    box-shadow: 0 0 0 rgba(34, 197, 94, 0); 
    border-color: var(--secondary-200);
  }
  50% { 
    box-shadow: 0 0 15px rgba(34, 197, 94, 0.3); 
    border-color: var(--success-400);
  }
  100% { 
    box-shadow: 0 0 0 rgba(34, 197, 94, 0); 
    border-color: var(--secondary-200);
  }
}

/* Pulse Animation for Status */
.pulse {
  animation: pulse 1.4s ease-in-out infinite alternate;
}

@keyframes pulse {
  from { opacity: 1; }
  to { opacity: 0.7; }
}

/* Responsive */
@media (max-width: 991.98px) {
  .hero-title-modern { font-size: 1.2rem; }
  .sticky-top { 
    position: static !important; 
    top: auto !important; 
  }
  
  .calc-item {
    padding: 0.5rem;
    gap: 0.5rem;
  }
  
  .calc-icon {
    width: 32px;
    height: 32px;
    font-size: 0.8rem;
  }
  
  .pricing-highlight-modern {
    padding: 0.75rem;
  }
  
  .price-modern {
    font-size: 1.1rem;
  }
}
</style>
{% endblock %}